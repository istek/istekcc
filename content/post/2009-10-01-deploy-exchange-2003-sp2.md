---
title: 实验:部署Exchange2003 SP2
date: 2009-10-01T05:42:54+00:00
layout: post
categories:
  - Windows
tags:
  - exchange2003
---
**实验日期：**

2009-9-30

**实验设备：**

1. 兼容机一台，作为AD,DNS,EXCHANGE服务器，可惜我没有多余的机器，IP192.168.0.4/24；
2. HP笔记本一台，作为客户端，IP192.168.0.8/24；
3. ADSL，无线路由DI 624+A各一台，无线路由配置为自动拨号，并且将TCP 80,443,25,110和UDP 53做端口映射至192.168.0.4。

**实验主题：**

在win2003 sp2上部署Exchange 2003 sp2

**实验原理:**

涉及到的知识点有：

Email的工作原理；

Web通信原理，包括安全HTTP；

DNS工作原理；

微软活动目录工作原理；
<!--more-->
**预期结果**：

因为没有公网IP，只要能发送邮件至公网和内网，就算成功。

**网络结构：**

![networktypo](https://farm4.static.flickr.com/3644/3969095630_310b62f434.jpg) 

**实验过程：** 

这次动手之前，做足了各种工作，昨天晚上看的那些安装资料，第一，不够细致，很多问题没有交代清楚；第二，对一些基本设置讲的不够。我都是东拼西凑的才把需要的东西找全。

因为昨天晚上已经部署Exchange2003失败了，所以今天的第一件工作就是重装操作系统，本想重新刻盘安装，使用Windows 2003 datacenter，但是感觉没有必要再去浪费光盘了，哈，于是还是用无限的未知Windows 2003版吧。

一些基本安装操作，我就再不罗嗦了。系统安装完成后，先更新系统补丁，然后安装IIS,NNTP,SMTP，ASP.NET这些服务和程序，在控制面板添加/删除里面就可以做。

之后使用“添加/删除程序”安装DNS，进行设置，关于如何设置，大家可以看我收集的这个文档。提示一下，因为域控制器和DNS安装在一台机器上，要解析公网的网址的话，就要使用区域复制功能，并且打开区域的动态更新为非安全。

![dns](https://farm3.static.flickr.com/2637/3968078373_cfef8ab83e.jpg)

开始-控制面板-管理工具-DNS-ServerName-正向查找区域-Domain，右键属性，“常规”中选择“动态更新”为“非安全”，在“区域复制”中选择“允许区域复制”，“只允许到下列服务器”，然后填入公网DNS地址，确定退出。

![dns-zonecopy](https://farm3.static.flickr.com/2558/3968852044_9fb861809b.jpg) 

之后，更新服务器端和客户端网卡的DNS设置为网卡地址。

![clientset](https://farm3.static.flickr.com/2612/3969095622_0c8c827df1.jpg)

现在开始安装活动目录，可以通过开始-控制面板-管理工具-管理你的服务器，添加一个角色，选择域控制器，启动安装向导。为你的域选择一个名称，比如上图中我们使用ipco.me，活动目录的安装没有任何难度，注意安装时的选项和填写内容，仔细一点就没什么问题。

接下来就可以开始部署Exchange2003了。

因为网络上部署手册很多，这里就给大家提供一个地址，看着根据说明进行安装。我个人觉得这个安装说明非常详细，详尽的指出了每一步的操作。

安装成功后，验证Exchange2003的服务是否全部启动，默认情况下，Microsoft Exchange POP3服务是禁止的，你需要手工改为自动模式，启动该服务。如果没有问题，现在就可以使用了，因为邮件系统是开放给公网的，所以补丁一定要达到最新，先安装SP2补丁，然后安装patch目录中的所有补丁，按照KB号由小到大的顺序安装。

安装完成后，Exchange2003就可以正常使用了。

可以通过OWA访问，[http://ExchangeSrv/exchange](http://exchangesrv/exchange) ，也可以使用邮件客户端访问。

因为Exchange扩展了域的架构，使其包含了Exchange特有的类和属性，并且创建了读取和修改用户属性所必需的用户组和权限。所以域用户可以使用Exchange信箱，需要做的就是给部署Exhange之前的域用户创建信箱即可。

打开控制面板-管理工具-Active Directory用户和计算机-ServerName-Users里面，选择某个用户，鼠标右键，会有一个“Exchange任务”，在这个选项里，你可以执行创建信箱，移动信箱，删除信箱及配置Exchange功能等任务。

如果要使用客户端，其POP服务器是Exchange服务器的IP地址或域名，SMTP服务器也是Exchange服务器的IP或域名。

至于Exchange的管理和其他高级操作，需要访问微软站点查询。

现在来说说打开POP,SMTP服务的安全连接。在打开安全连接之前，首先服务器应该安装证书服务，通过开始-控制面板-添加/删除程序-Windows组件。

然后打开Exchange系统管理器，“管理组”-“第一个管理组”-ServerName-“协议”-SMTP-默认SMTP虚拟服务器，右键属性，给它选择一个IP地址，点击“访问”标签，点击“访问控制”的“身份验证”，选择“基本身份验证”，“要求TLS加密”，“默认域”填写你的域名，“集成Windows身份验证”，点击确定保存，然后点击“安全通信”的“证书”，新建一个证书，之后到管理工具的证书颁发机构颁发证书就可以了。

POP的设置以此类推。

如果不打算使用安全连接，也请勾选SMTP的身份验证模式，防止别人恶意使用你的SMTP进行SPAM。

**实验结果：**

1. 未开SSL，访问OWA，发送邮件至公网信箱，收到。
2. 未开SSL，访问OWA，发送邮件至内网信箱，收到。
3. 打开SSL，访问OWA，发送邮件至公网信箱，收到。
4. 打开SSL，访问OWA，发送邮件至内网信箱，收到。
5. 未开SSL，通过邮件客户端，发送邮件至公网信箱，收到。
6. 未开SSL，通过邮件客户端，发送邮件至内网信箱，收到。
7. 打开SSL，通过邮件客户端，发送邮件至公网信箱，收到。
8. 打开SSL，通过邮件客户端，发送邮件至内网信箱，收到。

提供1个SMTPDIAG工具，用于诊断SMTP服务是否设置正常的工具，点击[这里](http://www.dbank.com/download.action?k=f86cf87ef35a462daa40c4099eadade5)下载。

这是另一个比较全面的部署手册，点[这里](http://redking.blog.51cto.com/27212/59017)。

[Suptools](http://www.dbank.com/download.action?k=a4eb671fa09c4002ad0be30235b18ec8)